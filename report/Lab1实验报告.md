# Lab1 实验报告

#### 姓名：杨迁		学号：19231120



## 1. 词法分析器的改进

原先的词法分析器是一个独立程序，现在为了配合语法分析程序，将词法分析器改造成了一个服务。词法分析器则从源文件读取字符并组合成单词，语法分析器则直接从词法分析器取单词。遇到不符合文法的情况，词法分析器会抛出异常；若所有单词都已读完（到了文件尾），返回`null`。

将空白符也纳入了词法分析自动机的识别范畴，即将空白符也视为字母表的一部分，在自动机的零状态（初始状态）允许输入任意个空白符（并且不进行记录）；在单行注释的状态允许接收`\n`和`\r`，代表注释结束。

将注释（段落注释和单行注释）也视为一个单词。当词法分析器识别出一段注释时不返回，而是继续循环。这样就在词法分析环节过滤了注释，不会对语法分析产生干扰。

将 Number 和 Ident 作为单独的衍生类从 Token 类中分离出来了，以方便获取其参数（名称、值等）。

将词法分析器改为了单例模式，需要用到词法分析器时直接获取唯一的一个实例，避免反复传参。



## 2. 语法树的构建

使用自顶向下的递归子程序法进行语法分析并构建语法树。定义了 IUnit 接口来泛化所有的语法成分（单词 Token 类也实现该接口，视为终结符），而其余所有非终结符均实现了自己的递归子程序`build()`方法和将语法成分输出为 LLVM 代码的方法 `dump()`。构建语法树时自顶向下递归调用 `build()`，遇到不符合语法的情况则抛出异常；转换为 LLVM 代码时自顶向下递归调用`dump()`。程序的入口实际上就是一个`new CompUnit().build()`。

